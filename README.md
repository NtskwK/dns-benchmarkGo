# dnspy 

ä¸€æ¬¾ç”¨äºæœ¬åœ°æµ‹è¯•å…¨ä¸–ç•Œçš„ DNS æœåŠ¡å™¨çš„å¯è®¿é—®æ€§å’Œæ€§èƒ½çš„æµ‹è¯•å·¥å…·

[English](./README.en.md) | [ä¸­æ–‡](./README.md)

ä½¿ç”¨ Golang ç¼–å†™æ”¯æŒ Windowsã€macOSã€Linuxã€‚

å¹¶ä¸”é™„å¸¦å¯è§†åŒ–åˆ†æç½‘ç«™è®©ä½ ä¸€ç›®äº†ç„¶çš„çŸ¥é“å¯ä»¥ç”¨å“ªäº› DNS æœåŠ¡å™¨ğŸ˜Šã€‚ï¼ˆè°ƒç”¨ç³»ç»Ÿè®¾ç½®çš„é»˜è®¤æµè§ˆå™¨ï¼‰

**Web dashboard is not support on GUI-less Linux**

**å¿…é¡»å…³é—­æ‰€æœ‰ä»£ç†è½¯ä»¶çš„ Tun æ¨¡å¼ã€è™šæ‹Ÿç½‘å¡æ¨¡å¼ï¼Œå¦åˆ™ä¼šå½±å“æµ‹è¯•ç»“æœã€‚**

> è‹¥å‡ºç°å¤šä¸ªæœåŠ¡å™¨çš„æµ‹è¯•å»¶è¿Ÿä¸ºå°äº5msï¼Œè¯·æ’æŸ¥ç½‘ç»œæœåŠ¡æ˜¯å¦è¢«å½“åœ°è¿è¥å•†åŠ«æŒçš„å¯èƒ½ã€‚

## æ•°æ®åˆ†æé¢æ¿é¢„è§ˆ

![æ•°æ®åˆ†æé¢æ¿é¢„è§ˆ](https://github.com/user-attachments/assets/c743f7ba-4d77-4d16-8515-02c0dc99ddfa)

[æ•°æ®åˆ†æé¢æ¿ï¼Œå†…å«ç¤ºä¾‹æ•°æ®](https://bench.dash.2020818.xyz)

## ä½¿ç”¨æ–¹å¼

![dnspy](https://github.com/user-attachments/assets/a499d2fc-ffcd-4b71-a0dd-d6e5839792dd)

åœ¨æœ¬ä»“åº“çš„ [releases](https://github.com/NtskwK/dns-benchmarkGo/releases) é¡µé¢ä¸­æŒ‰ä½ çš„ç³»ç»Ÿæ¶æ„è¿›è¡Œä¸‹è½½åç‚¹å‡»è¿è¡Œå³å¯ã€‚

ç¨‹åºé»˜è®¤ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å¼ï¼Œä»¥åŠ å¿«æµ‹è¯•é€Ÿåº¦ã€‚ä½†æ˜¯é»˜è®¤å‚æ•° 10 ä¸ªçº¿ç¨‹éœ€è¦è‡³å°‘ä¸Šä¸‹è¡Œ 1 MB/s ç½‘ç»œå’Œè‡³å°‘ 4 æ ¸å¿ƒå¤„ç†å™¨ã€‚
å¦‚æœç½‘ç»œæˆ–å¤„ç†å™¨ä¸å¥½ï¼Œä¼šå¯¼è‡´æµ‹è¯•ç»“æœä¸å‡†ç¡®ï¼Œè¯·é€šè¿‡`-w` å‚æ•°é™ä½çº¿ç¨‹æ•°ã€‚

æµ‹è¯•å®Œæˆåä¼šè¾“å‡ºåˆ°å½“å‰ç›®å½•ä¸‹å½¢å¦‚ `dnspy_result_2024-11-07-17-32-13.json` çš„ JSON æ–‡ä»¶ä¸­ã€‚

æŒ‰ç¨‹åºæç¤ºè¾“å…¥ `Y` æˆ– `y` æˆ–ç›´æ¥å›è½¦ï¼Œä¼šè‡ªåŠ¨æ‰“å¼€æ•°æ®åˆ†æé¢æ¿ç½‘ç«™ï¼Œç‚¹å‡»ç½‘ç«™å³ä¸Šè§’çš„ `è¯»å–åˆ†æ` æŒ‰é’®ï¼Œé€‰æ‹©ä½ åˆšæ‰çš„ JSON æ–‡ä»¶ï¼Œå°±å¯ä»¥çœ‹åˆ°å¯è§†åŒ–æµ‹è¯•ç»“æœäº†ã€‚

### æºç æ¨¡å¼ä¸‹è¿è¡Œ

#### 1. å…‹éš†æœ¬ä»“åº“å¹¶åˆå§‹åŒ–å­æ¨¡å—

  ```bash
  git clone --recurse-submodules https://github.com/NtskwK/dns-benchmarkGo.git
  cd dns-benchmarkGo
  ```

  å¦‚æœå·²ç»å…‹éš†äº†ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ–å­æ¨¡å—ï¼š

  ```bash
  git submodule update --init --recursive
  ```

#### 2. è¿è¡Œ

  ```bash
  go run .
  ```

## å¯ç”¨å‚æ•°

```batch
$dns-benchmarkGo --help

å‚æ•°è¯´æ˜:
  -c, --concurrency int   æ¯ä¸ªæµ‹è¯•å¹¶å‘æ•°
                           (default 10)
  -d, --domains string    è¦æ‰¹é‡æµ‹è¯•çš„åŸŸåæ•°æ®å­˜å‚¨çš„æ–‡ä»¶è·¯å¾„
                          å¿…é¡»æ˜¯ç›¸å¯¹å½“å‰ç¨‹åºå·¥ä½œè·¯å¾„çš„æ–‡ä»¶è·¯å¾„
                          æ–‡ä»¶å†…éƒ¨æ ¼å¼æ˜¯ä¸€è¡Œä¸€æ¡
                          ä¸ä¿®æ”¹åˆ™ä½¿ç”¨å†…ç½®çš„10000ä¸ªçƒ­é—¨åŸŸå
                           (default "@sampleDomains@")
  -t, --duration int      æ¯ä¸ªæµ‹è¯•æŒç»­æ—¶é—´,å•ä½ç§’
                           (default 10)
  -f, --file string       è¦æ‰¹é‡æµ‹è¯•çš„æœåŠ¡å™¨æ•°æ®å­˜å‚¨çš„æ–‡ä»¶è·¯å¾„
                          å¿…é¡»æ˜¯ç›¸å¯¹å½“å‰ç¨‹åºå·¥ä½œè·¯å¾„çš„æ–‡ä»¶è·¯å¾„
                          æ–‡ä»¶å†…éƒ¨æ ¼å¼æ˜¯ä¸€è¡Œä¸€æ¡

  -g, --geo string        ç‹¬ç«‹åŠŸèƒ½: ä½¿ç”¨ GeoIP æ•°æ®åº“è¿›è¡Œ IP æˆ–åŸŸåå½’å±åœ°æŸ¥è¯¢

      --json              ä»¥jsonæ ¼å¼è¾“å‡ºæ—¥å¿—

  -l, --level string      æ—¥å¿—çº§åˆ«
                          å¯é€‰ debug,info,warn,error,fatal,panic
                           (default "info")
      --no-aaaa           æ¯ä¸ªæµ‹è¯•ä¸è§£æ AAAA è®°å½•

  -o, --output string     è¾“å‡ºç»“æœçš„æ–‡ä»¶è·¯å¾„
                          å¿…é¡»æ˜¯ç›¸å¯¹å½“å‰ç¨‹åºå·¥ä½œè·¯å¾„çš„æ–‡ä»¶è·¯å¾„
                          ä¸æŒ‡å®šåˆ™è¾“å‡ºåˆ°å½“å‰å·¥ä½œè·¯å¾„ä¸‹çš„ dnspy_result_<å½“å‰æ—¶é—´>.json

      --prefer-ipv4       åœ¨DNSæœåŠ¡å™¨çš„åŸŸåè½¬æ¢ä¸ºIPåœ°å€è¿‡ç¨‹ä¸­ä¼˜å…ˆä½¿ç”¨IPv4åœ°å€
                           (default true)
  -s, --server strings    æ‰‹åŠ¨æŒ‡å®šè¦æµ‹è¯•çš„æœåŠ¡å™¨,æ”¯æŒå¤šä¸ª

  -w, --worker int        åŒä¸€æ—¶é—´æµ‹è¯•å¤šå°‘ä¸ª DNS æœåŠ¡å™¨
                           (default 20)
```

## ç¼–è¯‘

ç¼–è¯‘æ‰€éœ€ç¯å¢ƒï¼š

- ä½ çš„ç”µè„‘ä¸Šéœ€è¦æœ‰ `Go` ç¯å¢ƒã€`curl` å‘½ä»¤ï¼Œæœ€å¥½æœ‰`make`å‘½ä»¤ï¼Œä¸ç„¶ä½ å¯èƒ½éœ€è¦æ‰‹åŠ¨æ‰§è¡Œ`makefile`ä¸­çš„å†…å®¹

- èƒ½å¤Ÿè®¿é—® Github ä¸‹è½½èµ„æºæ–‡ä»¶

- è‹¥åœ¨Windowså‡ºç°ä»¥ä¸‹é—®é¢˜ï¼Œè¯·æ”¹ç”¨`gitbash`æ‰§è¡Œå‘½ä»¤å†…å®¹ã€‚

> 'GOOS' is not recognized as an internal or external command,
operable program or batch file.

### ç¼–è¯‘è¿‡ç¨‹

#### 1. å…‹éš†æœ¬ä»“åº“å¹¶åˆå§‹åŒ–å­æ¨¡å—

  ```bash
  # å…‹éš†æœ¬ä»“åº“ï¼ˆåŒ…å«å­æ¨¡å—ï¼‰
  git clone --recurse-submodules https://github.com/NtskwK/dns-benchmarkGo.git
  cd dns-benchmarkGo
  ```

  å¦‚æœå·²ç»å…‹éš†äº†ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ–å­æ¨¡å—ï¼š

  ```bash
  git submodule update --init --recursive
  cd src
  ```

#### 2. æ›´æ–°æ•°æ®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

  ```bash
  # æ›´æ–°æ‰€æœ‰
  make update 
  # æ›´æ–°geodata
  make update-geodata 
  # æ›´æ–°æµ‹è¯•ç”¨åŸŸå
  make update-domains
  # æ›´æ–° dnspyre å­æ¨¡å—
  make update-dnspyre
  ```

#### 3. è¿›è¡Œç¼–è¯‘

  ```bash
  make build
  ```

## Thanks

- [dns-benchmark](https://github.com/xxnuo/dns-benchmark)
- [dnspyre](https://github.com/Tantalor93/dnspyre)
