# dnspy - ç”¨äºæœ¬åœ°æµ‹è¯•å…¨ä¸–ç•Œçš„ DNS æœåŠ¡å™¨çš„å¯è®¿é—®æ€§å’Œæ€§èƒ½çš„æµ‹è¯•å·¥å…·

[English](./README.en.md) | [ä¸­æ–‡](./README.md)

è‹¦äºå›½å†…çš„ DNS è¢«è¿è¥å•†åŠ«æŒï¼Œéœ€è¦å¯é çš„æœåŠ¡æ¥æ”¯æŒæ­£å¸¸çš„ä¸Šç½‘ã€‚

ç°æœ‰çš„å·¥å…·ä¸å¤šï¼Œæœ‰ dnsjumper å­˜åœ¨ä»…æ”¯æŒ Windowsã€æ•°æ®æºè¾ƒå°‘ã€è¯„æµ‹ç»´åº¦å°‘çš„é—®é¢˜

æ‰€ä»¥åšäº†ä¸ªå·¥å…·æ¥æµ‹è¯•ä¸€ä¸‹æœ¬åœ°ç½‘ç»œèƒ½æ­£å¸¸ä½¿ç”¨çš„æœåŠ¡å™¨ä»¥åŠæœåŠ¡å™¨çš„æ€§èƒ½çš„å·¥å…·ï¼Œä½¿ç”¨ Golang ç¼–å†™æ”¯æŒ Windowsã€macOSã€Linuxã€‚

å¹¶ä¸”é™„å¸¦å¯è§†åŒ–åˆ†æç½‘ç«™è®©ä½ ä¸€ç›®äº†ç„¶çš„çŸ¥é“å¯ä»¥ç”¨å“ªäº› DNS æœåŠ¡å™¨ğŸ˜Šï¼Œæ¸©é¦¨æç¤ºï¼šç‚¹å‡»æ•°æ®åˆ†æé¢æ¿çš„æŸ±çŠ¶å›¾å³å¯å¤åˆ¶æœåŠ¡å™¨åœ°å€

ä½¿ç”¨æ–¹æ³•ï¼šæŒ‰ä¸‹æ–‡æŒ‡å¯¼ä¸‹è½½æµ‹è¯•å·¥å…·è·å¾—æµ‹è¯•ç»“æœçš„ json æ–‡ä»¶ï¼Œæ‰“å¼€åˆ†æé¢æ¿ç½‘ç«™ä¸Šä¼ æ•°æ®åˆ†æå³å¯ã€‚ç½‘ç«™ä¸å­˜å‚¨æ•°æ®ã€‚

## æ•°æ®åˆ†æé¢æ¿é¢„è§ˆ

![æ•°æ®åˆ†æé¢æ¿é¢„è§ˆ](https://github.com/user-attachments/assets/c743f7ba-4d77-4d16-8515-02c0dc99ddfa)

[æ•°æ®åˆ†æé¢æ¿ï¼Œå†…å«ç¤ºä¾‹æ•°æ®](https://bench.dash.2020818.xyz)

## ä½¿ç”¨æ–¹å¼

![dnspy](https://github.com/user-attachments/assets/a499d2fc-ffcd-4b71-a0dd-d6e5839792dd)

åœ¨æœ¬ä»“åº“çš„ [releases](https://github.com/xxnuo/dns-benchmark/releases) é¡µé¢ä¸­æŒ‰ä½ çš„ç³»ç»Ÿæ¶æ„ä¸‹è½½ `dnspy-*` æ–‡ä»¶ï¼Œæ¯”å¦‚ M ç³»åˆ—å¤„ç†å™¨çš„ macOSï¼Œæ‰€ä»¥ä¸‹è½½ `dnspy-darwin-arm64` æ–‡ä»¶ã€‚

ç„¶å**å¿…é¡»å…³é—­æ‰€æœ‰ä»£ç†è½¯ä»¶çš„ Tun æ¨¡å¼ã€è™šæ‹Ÿç½‘å¡æ¨¡å¼ï¼Œå¦åˆ™ä¼šå½±å“æµ‹è¯•ç»“æœã€‚**
ç„¶å**å¿…é¡»å…³é—­æ‰€æœ‰ä»£ç†è½¯ä»¶çš„ Tun æ¨¡å¼ã€è™šæ‹Ÿç½‘å¡æ¨¡å¼ï¼Œå¦åˆ™ä¼šå½±å“æµ‹è¯•ç»“æœã€‚**
ç„¶å**å¿…é¡»å…³é—­æ‰€æœ‰ä»£ç†è½¯ä»¶çš„ Tun æ¨¡å¼ã€è™šæ‹Ÿç½‘å¡æ¨¡å¼ï¼Œå¦åˆ™ä¼šå½±å“æµ‹è¯•ç»“æœã€‚**

é‡å‘½åæ–‡ä»¶ä¸º `dnspy`ï¼ˆWindows æ˜¯ `dnspy.exe`ï¼‰ï¼Œç„¶åæ‰“å¼€ç»ˆç«¯ï¼Œè¿›å…¥åˆ°ä½ è¿™ä¸ªæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚æ‰§è¡Œå‘½ä»¤å¼€å§‹æµ‹è¯•

```bash
unset http_proxy https_proxy all_proxy HTTP_PROXY HTTPS_PROXY ALL_PROXY
./dnspy
```

æŒ‰æç¤ºè¾“å…¥å¯åŠ¨æµ‹è¯•

é»˜è®¤ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å¼ï¼Œä»¥åŠ å¿«æµ‹è¯•é€Ÿåº¦ã€‚ä½†æ˜¯é»˜è®¤å‚æ•° 10 ä¸ªçº¿ç¨‹éœ€è¦è‡³å°‘ä¸Šä¸‹è¡Œ 1 MB/s ç½‘ç»œå’Œè‡³å°‘ 4 æ ¸å¿ƒå¤„ç†å™¨ã€‚
å¦‚æœç½‘ç»œæˆ–å¤„ç†å™¨ä¸å¥½ï¼Œä¼šå¯¼è‡´æµ‹è¯•ç»“æœä¸å‡†ç¡®ï¼Œå¿…é¡»é€šè¿‡`-w` å‚æ•°é™ä½çº¿ç¨‹æ•°ã€‚

æµ‹è¯•å®Œæˆåä¼šè¾“å‡ºåˆ°å½“å‰ç›®å½•ä¸‹å½¢å¦‚ `dnspy_result_2024-11-07-17-32-13.json` çš„ JSON æ–‡ä»¶ä¸­ã€‚

æŒ‰ç¨‹åºæç¤ºè¾“å…¥ `Y` æˆ– `y` æˆ–ç›´æ¥å›è½¦ï¼Œä¼šè‡ªåŠ¨æ‰“å¼€æ•°æ®åˆ†æé¢æ¿ç½‘ç«™ï¼Œç‚¹å‡»ç½‘ç«™å³ä¸Šè§’çš„ `è¯»å–åˆ†æ` æŒ‰é’®ï¼Œé€‰æ‹©ä½ åˆšæ‰çš„ JSON æ–‡ä»¶ï¼Œå°±å¯ä»¥çœ‹åˆ°å¯è§†åŒ–æµ‹è¯•ç»“æœäº†ã€‚

### æºç æ¨¡å¼ä¸‹è¿è¡Œ

#### 1. å…‹éš†æœ¬ä»“åº“å¹¶åˆå§‹åŒ–å­æ¨¡å—

  ```bash
  git clone --recurse-submodules https://github.com/xxnuo/dns-benchmark.git
  cd dns-benchmark/src
  ```

  å¦‚æœå·²ç»å…‹éš†äº†ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ–å­æ¨¡å—ï¼š

  ```bash
  git submodule update --init --recursive
  ```

#### 2. è¿è¡Œ

  ```bash
  go run .
  ```

## å¯ç”¨å‚æ•°

```batch
~> dnspy-windows-amd64.exe -h  

ä½¿ç”¨ç¤ºä¾‹:

dnspy

ä½¿ç”¨å†…ç½®çš„ä¸–ç•Œæ‰€æœ‰åŸŸåç›´æ¥å¯åŠ¨æµ‹è¯•

dnspy -s 114.114.114.114

æµ‹è¯•å•ä¸ªæœåŠ¡å™¨

dnspy dnspy_benchmark_2024-10-22-08-18.json

å¯¹æµ‹è¯•ç»“æœè¿›è¡Œå¯è§†åŒ–åˆ†æ

å‚æ•°è¯´æ˜:
  -c, --concurrency int   æ¯ä¸ªæµ‹è¯•å¹¶å‘æ•°
                           (default 10)
  -d, --domains string    è¦æ‰¹é‡æµ‹è¯•çš„åŸŸåæ•°æ®å­˜å‚¨çš„æ–‡ä»¶è·¯å¾„
                          å¿…é¡»æ˜¯ç›¸å¯¹å½“å‰ç¨‹åºå·¥ä½œè·¯å¾„çš„æ–‡ä»¶è·¯å¾„
                          æ–‡ä»¶å†…éƒ¨æ ¼å¼æ˜¯ä¸€è¡Œä¸€æ¡
                          ä¸ä¿®æ”¹åˆ™ä½¿ç”¨å†…ç½®çš„10000ä¸ªçƒ­é—¨åŸŸå
                           (default "@sampleDomains@")
  -t, --duration int      æ¯ä¸ªæµ‹è¯•æŒç»­æ—¶é—´,å•ä½ç§’
                           (default 10)
  -f, --file string       è¦æ‰¹é‡æµ‹è¯•çš„æœåŠ¡å™¨æ•°æ®å­˜å‚¨çš„æ–‡ä»¶è·¯å¾„
                          å¿…é¡»æ˜¯ç›¸å¯¹å½“å‰ç¨‹åºå·¥ä½œè·¯å¾„çš„æ–‡ä»¶è·¯å¾„
                          æ–‡ä»¶å†…éƒ¨æ ¼å¼æ˜¯ä¸€è¡Œä¸€æ¡

  -g, --geo string        ç‹¬ç«‹åŠŸèƒ½: ä½¿ç”¨ GeoIP æ•°æ®åº“è¿›è¡Œ IP æˆ–åŸŸåå½’å±åœ°æŸ¥è¯¢

      --json              ä»¥jsonæ ¼å¼è¾“å‡ºæ—¥å¿—

  -l, --level string      æ—¥å¿—çº§åˆ«
                          å¯é€‰ debug,info,warn,error,fatal,panic
                           (default "info")
      --no-aaaa           æ¯ä¸ªæµ‹è¯•ä¸è§£æ AAAA è®°å½•

      --old-html          å·²å¼ƒç”¨ä¸å»ºè®®ä½¿ç”¨
                          å»ºè®®æ”¹ç”¨å¦‚ <ç¤ºä¾‹1> ç¨‹åºå…ˆç›´æ¥è§£æè¾“å‡ºæ•°æ® json æ–‡ä»¶å¹¶æŒ‰æç¤ºç›´æ¥æŸ¥çœ‹å¯è§†åŒ–æ•°æ®åˆ†æ
                          å¦‚ä¸‹æ¬¡éœ€è¦æŸ¥çœ‹å¯è§†åŒ–æ•°æ®åˆ†æå¯å¦‚ <ç¤ºä¾‹3> ç”¨ç¨‹åºæ‰“å¼€ json æ–‡ä»¶
                          æœ¬å‚æ•°ä½¿ç”¨æ—§ç‰ˆæ–¹å¼è¾“å‡ºå•ä¸ª HTML æ–‡ä»¶åˆ°æ•°æ® json åŒç›®å½•
                          å¯åŒå‡»æ‰“å¼€æŸ¥çœ‹

  -o, --output string     è¾“å‡ºç»“æœçš„æ–‡ä»¶è·¯å¾„
                          å¿…é¡»æ˜¯ç›¸å¯¹å½“å‰ç¨‹åºå·¥ä½œè·¯å¾„çš„æ–‡ä»¶è·¯å¾„
                          ä¸æŒ‡å®šåˆ™è¾“å‡ºåˆ°å½“å‰å·¥ä½œè·¯å¾„ä¸‹çš„ dnspy_result_<å½“å‰æ—¶é—´>.json

      --prefer-ipv4       åœ¨DNSæœåŠ¡å™¨çš„åŸŸåè½¬æ¢ä¸ºIPåœ°å€è¿‡ç¨‹ä¸­ä¼˜å…ˆä½¿ç”¨IPv4åœ°å€
                           (default true)
  -s, --server strings    æ‰‹åŠ¨æŒ‡å®šè¦æµ‹è¯•çš„æœåŠ¡å™¨,æ”¯æŒå¤šä¸ª

  -w, --worker int        åŒä¸€æ—¶é—´æµ‹è¯•å¤šå°‘ä¸ª DNS æœåŠ¡å™¨
                           (default 20)
```

## ç¼–è¯‘

ç¼–è¯‘æ‰€éœ€ç¯å¢ƒï¼š

- ä½ çš„ç”µè„‘ä¸Šéœ€è¦æœ‰ `Go` ç¯å¢ƒã€`curl` å‘½ä»¤ï¼Œæœ€å¥½æœ‰`make`å‘½ä»¤ï¼Œä¸ç„¶ä½ å¯èƒ½éœ€è¦æ‰‹åŠ¨æ‰§è¡Œ`makefile`ä¸­çš„å†…å®¹

- èƒ½å¤Ÿè®¿é—® Github ä¸‹è½½èµ„æºæ–‡ä»¶

- è‹¥åœ¨Windowså‡ºç°ä»¥ä¸‹é—®é¢˜ï¼Œè¯·æ”¹ç”¨`gitbash`æ‰§è¡Œå‘½ä»¤å†…å®¹ã€‚

> 'GOOS' is not recognized as an internal or external command,
operable program or batch file.

### ç¼–è¯‘è¿‡ç¨‹

#### 1. å…‹éš†æœ¬ä»“åº“å¹¶åˆå§‹åŒ–å­æ¨¡å—

  ```bash
  # å…‹éš†æœ¬ä»“åº“ï¼ˆåŒ…å«å­æ¨¡å—ï¼‰
  git clone --recurse-submodules https://github.com/xxnuo/dns-benchmark.git
  cd dns-benchmark/src
  ```

  å¦‚æœå·²ç»å…‹éš†äº†ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ–å­æ¨¡å—ï¼š

  ```bash
  git submodule update --init --recursive
  cd src
  ```

#### 2. æ›´æ–°æ•°æ®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

  ```bash
  # æ›´æ–°æ‰€æœ‰
  make update 
  # æ›´æ–°geodata
  make update-geodata 
  # æ›´æ–°æµ‹è¯•ç”¨åŸŸå
  make update-domains
  # æ›´æ–° dnspyre å­æ¨¡å—
  make update-dnspyre
  ```

#### 3. è¿›è¡Œç¼–è¯‘

  ```bash
  make build
  ```
